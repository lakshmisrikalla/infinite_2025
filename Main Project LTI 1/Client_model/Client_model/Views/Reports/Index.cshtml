@model Client_model.Models.ReportsPageVm
@{
    ViewBag.Title = "Provider Dashboard - Reports";
}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" />

<div class="container mt-3">
    <h3>Reports</h3>

    <form method="get" class="form-inline mb-3">
        <label class="mr-2">From</label>
        <input type="date" name="from" value="@(Model.From?.ToString("yyyy-MM-dd"))" class="form-control mr-2" />
        <label class="mr-2">To</label>
        <input type="date" name="to" value="@(Model.To?.ToString("yyyy-MM-dd"))" class="form-control mr-2" />
        <label class="mr-2">Year</label>
        <select name="year" class="form-control mr-2">
            <option value="">--</option>
            @for (int y = DateTime.UtcNow.Year; y >= DateTime.UtcNow.Year - 5; y--)
            {
                <option value="@y" @(Model.Year == y ? "selected" : "")>@y</option>
            }
        </select>
        <label class="mr-2">Quarter</label>
        <select name="quarter" class="form-control mr-2">
            <option value="">--</option>
            <option value="1" @(Model.Quarter == 1 ? "selected" : "")>Q1</option>
            <option value="2" @(Model.Quarter == 2 ? "selected" : "")>Q2</option>
            <option value="3" @(Model.Quarter == 3 ? "selected" : "")>Q3</option>
            <option value="4" @(Model.Quarter == 4 ? "selected" : "")>Q4</option>
        </select>
        <button class="btn btn-primary" type="submit">Apply</button>
        <a class="btn btn-secondary ml-2" href="@Url.Action("Index", "Reports")">Reset</a>
    </form>

    <div class="row mb-3">
        <div class="col-md-3">
            <div class="card text-white bg-primary">
                <div class="card-body">
                    <h5>Total Amount</h5>
                    <h3>₹@Model.TotalAmount.ToString("N2")</h3>
                    <small>in selected range</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <h5>Total Buyers</h5>
                    <h3>@Model.TotalBuyers</h3>
                    <small>distinct buyers</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-info">
                <div class="card-body">
                    <h5>Policies Sold</h5>
                    <h3>@Model.PoliciesSold</h3>
                    <small>activated/purchased</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-warning">
                <div class="card-body">
                    <h5>Pending Dues</h5>
                    <h3>@Model.DueCount</h3>
                    <small>due dates unpaid</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Top policies -->
        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header">Top Policies (by premium)</div>
                <div class="card-body">
                    <ul class="list-group">
                        @foreach (var t in Model.TopPoliciesByAmount ?? new List<Client_model.Models.TopPolicyVm>())
                        {
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>@t.PolicyName</strong><br />
                                    <small>@t.BuyersCount buyers</small>
                                </div>
                                <span>₹@t.TotalCollected.ToString("N2")</span>
                            </li>
                        }
                    </ul>
                </div>
            </div>
        </div>

        <!-- Lowest policies -->
        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-header">Lowest Policies (by premium)</div>
                <div class="card-body">
                    <ul class="list-group">
                        @foreach (var t in Model.LowPoliciesByAmount ?? new List<Client_model.Models.TopPolicyVm>())
                        {
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>@t.PolicyName</strong><br />
                                    <small>@t.BuyersCount buyers</small>
                                </div>
                                <span>₹@t.TotalCollected.ToString("N2")</span>
                            </li>
                        }
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
