@model Client_model.Models.DashboardSummaryVm
@{ ViewBag.Title = "Dashboard"; }

<div class="row g-3">
    <div class="col-md-3">@Html.Partial("_SummaryCard", new { Label="Active Policies", Value=Model.ActivePolicies, Icon="bi-check2-circle" })</div>
  <div class="col-md-3">@Html.Partial("_SummaryCard", new { Label="Policy Holders", Value=Model.PolicyHolders, Icon="bi-people" })</div>
  <div class="col-md-3">@Html.Partial("_SummaryCard", new { Label="Claims", Value=Model.ClaimsCount, Icon="bi-clipboard2-pulse" })</div>
  <div class="col-md-3">@Html.Partial("_SummaryCard", new { Label="Pending Approvals", Value=Model.PendingApprovals, Icon="bi-patch-question" })</div>
  <div class="col-md-3">@Html.Partial("_SummaryCard", new { Label="Pending Renewals", Value=Model.PendingRenewals, Icon="bi-arrow-repeat" })</div>
  <div class="col-md-3">@Html.Partial("_SummaryCard", new { Label="Due Soon (30d)", Value=Model.DueSoon, Icon="bi-calendar-event" })</div>
  <div class="col-md-3">@Html.Partial("_SummaryCard", new { Label="Total Collected (₹)", Value=Model.CollectedPayments.ToString("N2"), Icon="bi-currency-rupee" })</div>
</div>

@*<div class="row g-3 mt-1">
  <div class="col-lg-7">
    <div class="card card-soft"><div class="card-body">
      <h6 class="mb-3">Revenue (last 6 months)</h6>
      <canvas id="revChart"></canvas>
    </div></div>
  </div>*@
  <div class="col-lg-5">
    <div class="card card-soft"><div class="card-body">
      <h6 class="mb-3">Top Policies by Holders</h6>
      <canvas id="topChart"></canvas>
    </div></div>
  </div>
</div>

<script>
  const revLabels = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.RevenueByMonth.Select(x=>x.Label)));
  const revData   = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.RevenueByMonth.Select(x=>x.Value)));
  new Chart(document.getElementById('revChart'), {
    type:'line',
    data:{ labels:revLabels, datasets:[{ label:'Revenue (₹)', data:revData, tension:.3, fill:true }]},
    options:{ scales:{ y:{ beginAtZero:true } } }
  });

  const topLabels = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.TopPolicies.Select(x=>x.Label)));
  const topData   = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.TopPolicies.Select(x=>x.Value)));
  new Chart(document.getElementById('topChart'), {
    type:'bar',
    data:{ labels:topLabels, datasets:[{ label:'Holders', data:topData }]},
    options:{ scales:{ y:{ beginAtZero:true } }, plugins:{ legend:{display:false}} }
  });
</script>
