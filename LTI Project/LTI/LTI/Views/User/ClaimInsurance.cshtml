@{
    Layout = null;
    var policies = ViewBag.Policies as List<SelectListItem>;
    var policyAmounts = ViewBag.PolicyAmounts as Dictionary<int, decimal>;
    bool isSuccess = TempData["SuccessMessage"] != null;
}

<div class="container mt-5">
    <h2>📝 Submit Insurance Claim</h2>

    @if (isSuccess)
    {
        <div class="alert alert-success text-center">
            @TempData["SuccessMessage"]
            <div class="mt-3">
                <a href="/User/Dashboard" class="btn btn-outline-primary">Go to Dashboard</a>
            </div>
        </div>
    }
    else
    {
        <form method="post" enctype="multipart/form-data" action="/User/ClaimInsurance">
            <div class="mb-3">
                <label for="UserPolicyID" class="form-label">Select Policy</label>
                <select name="UserPolicyID" id="UserPolicyID" class="form-control" required onchange="updateAmount()">
                    <option value="">-- Select Policy --</option>
                    @foreach (var policy in policies)
                    {
                        <option value="@policy.Value">@policy.Text</option>
                    }
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">Policy Amount (Base Premium)</label>
                <input type="text" id="PolicyAmountDisplay" class="form-control" readonly />
            </div>

            <div class="mb-3">
                <label for="ClaimType" class="form-label">Claim Type</label>
                <select name="ClaimType" id="ClaimType" class="form-control" required>
                    <option value="">-- Select --</option>
                    <option>Accident</option>
                    <option>Medical</option>
                    <option>Theft</option>
                    <option>Damage</option>
                    <option>Other</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="Reason" class="form-label">Reason for Claim</label>
                <textarea name="Reason" id="Reason" class="form-control" rows="4" required></textarea>
            </div>

            <div class="mb-3">
                <label for="ClaimedAmount" class="form-label">Claimed Amount (₹)</label>
                <input type="number" name="ClaimedAmount" id="ClaimedAmount" class="form-control" step="0.01" required />
            </div>

            <div class="mb-3">
                <label for="ClaimDocument" class="form-label">Upload Supporting Document</label>
                <input type="file" name="ClaimDocument" id="ClaimDocument" class="form-control" required />
            </div>

            <button type="submit" class="btn btn-success">Submit Claim</button>
        </form>
    }
</div>

@if (policyAmounts != null)
{
    <script>
        const policyAmounts = {
            @foreach (var entry in policyAmounts)
            {
                @: "@entry.Key": "@entry.Value.ToString("F2")",
            }
        };

        function updateAmount() {
            const selectedId = document.getElementById("UserPolicyID").value;
            const amount = policyAmounts[selectedId] || "";
            document.getElementById("PolicyAmountDisplay").value = amount ? `₹${amount}` : "";
        }
    </script>
}
